"use strict";(self.webpackChunkyeom_se_been_fanpage=self.webpackChunkyeom_se_been_fanpage||[]).push([[580],{6580:(e,s,t)=>{t.r(s),t.d(s,{default:()=>p});var r=t(5043),n=t(9367),a=t(5200),i=t(184),c=t(4524),o=t(1089),l=t(7417),d=t(1719),h=t(4282),u=t(457),m=t(791),x=t(6667),g=t(8279),j=t(9437),w=t(4196),f=t(579);const A=()=>{const[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)([]),[a]=(0,g.hD)(m.j),[c,o]=(0,r.useState)(!0),[l,d]=(0,r.useState)(10),[u,A]=(0,r.useState)(1);(0,r.useEffect)(()=>{o(!0);const e=(0,x.rJ)(m.db,"scores"),t=(0,x.P)(e,(0,x.My)("score","desc")),r=(0,x.aQ)(t,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));s(t),o(!1)},e=>{console.error("Error fetching scores:",e),o(!1)});return()=>r()},[]),(0,r.useEffect)(()=>{const s=(u-1)*l,t=s+l;n(e.slice(s,t))},[e,u,l]);const y=Math.ceil(e.length/l),p=e=>{const s=(u-1)*l+e;return 0===s?"rank-gold":1===s?"rank-silver":2===s?"rank-bronze":""};return(0,f.jsxs)("div",{className:"leaderboard-container mt-5",children:[(0,f.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,f.jsx)("h2",{className:"leaderboard-title mb-0",children:"\u6392\u884c\u699c"}),(0,f.jsxs)(j.A,{children:[(0,f.jsxs)(j.A.Toggle,{id:"dropdown-pagesize",size:"sm",className:"btn-theme-gradient",children:["\u6bcf\u9801 ",l," \u7b46"]}),(0,f.jsxs)(j.A.Menu,{children:[(0,f.jsx)(j.A.Item,{onClick:()=>d(10),children:"10"}),(0,f.jsx)(j.A.Item,{onClick:()=>d(20),children:"20"}),(0,f.jsx)(j.A.Item,{onClick:()=>d(50),children:"50"}),(0,f.jsx)(j.A.Item,{onClick:()=>d(100),children:"100"})]})]})]}),(0,f.jsxs)(w.A,{striped:!0,bordered:!0,responsive:!0,variant:"dark",children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"#"}),(0,f.jsx)("th",{children:"\u73a9\u5bb6"}),(0,f.jsx)("th",{children:"\u5206\u6578"}),(0,f.jsx)("th",{children:"\u65e5\u671f"})]})}),(0,f.jsx)("tbody",{children:c?(0,f.jsx)("tr",{children:(0,f.jsx)("td",{colSpan:"4",className:"text-center",children:"\u8f09\u5165\u4e2d..."})}):t.map((e,s)=>{var t;return(0,f.jsxs)("tr",{className:`${p((u-1)*l+s)} ${a&&e.userId===a.uid?"current-user-row":""}`,children:[(0,f.jsx)("td",{className:"rank-cell",children:(u-1)*l+s+1<=3?(0,f.jsx)(i.SBv,{className:"trophy-icon"}):(u-1)*l+s+1}),(0,f.jsx)("td",{children:e.userName}),(0,f.jsx)("td",{children:e.score}),(0,f.jsx)("td",{children:new Date(null===(t=e.createdAt)||void 0===t?void 0:t.toDate()).toLocaleDateString()})]},e.id)})})]}),(0,f.jsxs)("div",{className:"d-flex justify-content-between mt-3",children:[u>1&&(0,f.jsx)(h.A,{onClick:()=>{u>1&&A(e=>e-1)},disabled:c,variant:"secondary",children:"\u4e0a\u4e00\u9801"}),u<y&&(0,f.jsx)(h.A,{onClick:()=>{u<y&&A(e=>e+1)},disabled:c,variant:"secondary",className:"ms-auto",children:"\u4e0b\u4e00\u9801"})]})]})},y=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return[...e].sort(()=>.5-Math.random()).slice(0,s)};const p=function(){var e,s;const[t,j]=(0,r.useState)([]),[w,p]=(0,r.useState)([]),[N,b]=(0,r.useState)(0),[v,z]=(0,r.useState)(0),[C,D]=(0,r.useState)(!1),[S,k]=(0,r.useState)(!0),[B,I]=(0,r.useState)(null),[O,q]=(0,r.useState)([]),[L]=(0,g.hD)(m.j),[Q,E]=(0,r.useState)(!1),[$,_]=(0,r.useState)(""),[G,H]=(0,r.useState)("success");(0,r.useEffect)(()=>{(async()=>{try{const e=(await(0,x.GG)((0,x.rJ)(m.db,"quizzes"))).docs.map(e=>e.data());j(e),p(y(e)),k(!1)}catch(e){console.error("Error fetching questions from Firestore:",e),I("\u7121\u6cd5\u8f09\u5165\u984c\u76ee\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u3002"),k(!1)}})()},[]),(0,r.useEffect)(()=>{(async()=>{if(C&&L&&!L.isAnonymous)try{await(0,x.gS)((0,x.rJ)(m.db,"scores"),{userName:L.displayName,userId:L.uid,score:v,userAnswers:O,createdAt:(0,x.O5)()})}catch(e){console.error("Error adding document: ",e)}})()},[C,L,v,O]);const T=(0,r.useCallback)(async()=>{if(!L||L.isAnonymous)return;const e=(0,x.H9)(m.db,"userAchievements",L.uid),s=await(0,x.x7)(e),t=s.exists()?s.data():{},r={userName:L.displayName,userEmail:L.email};v!==w.length||t.firstPerfectScore||(await(0,x.BN)(e,{...r,firstPerfectScore:!0,firstPerfectScoreDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u9996\u6b21\u4f5c\u7b54\u5168\u5c0d] \u6210\u5c31\uff01")),0!==v||t.firstAllWrong||(await(0,x.BN)(e,{...r,firstAllWrong:!0,firstAllWrongDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u9996\u6b21\u5168\u932f] \u6210\u5c31\uff01"));const n=t.loginDaysCount||0;n>=1&&!t.firstLogin&&(await(0,x.BN)(e,{...r,firstLogin:!0,firstLoginDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u9996\u6b21\u767b\u5165] \u6210\u5c31\uff01")),n>=3&&!t.threeDayLogin&&(await(0,x.BN)(e,{...r,threeDayLogin:!0,threeDayLoginDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u4f86\u4e09\u5929\u56c9] \u6210\u5c31\uff01")),n>=7&&!t.sevenDayLogin&&(await(0,x.BN)(e,{...r,sevenDayLogin:!0,sevenDayLoginDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u963f\u5f6c\u9435\u7c89] \u6210\u5c31\uff01")),n>=30&&!t.thirtyDayLogin&&(await(0,x.BN)(e,{...r,thirtyDayLogin:!0,thirtyDayLoginDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u5973\u738b\u7684\u5fe0\u5be6\u8b77\u885b] \u6210\u5c31\uff01"));const a=t.totalQuizzesAnswered||0,i=t.totalCorrectAnswers||0,c=t.totalIncorrectAnswers||0;i>=10&&!t.tenCorrectAnswers&&(await(0,x.BN)(e,{...r,tenCorrectAnswers:!0,tenCorrectAnswersDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u5c0f\u6709\u6210\u5c31] \u6210\u5c31\uff01")),i>=50&&!t.fiftyCorrectAnswers&&(await(0,x.BN)(e,{...r,fiftyCorrectAnswers:!0,fiftyCorrectAnswersDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u92fc\u9435\u7c89\u7d72] \u6210\u5c31\uff01")),i>=100&&!t.hundredCorrectAnswers&&(await(0,x.BN)(e,{...r,hundredCorrectAnswers:!0,hundredCorrectAnswersDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u963f\u5f6c\u77e5\u8b58\u738b] \u6210\u5c31\uff01")),c>=10&&!t.tenIncorrectAnswers&&(await(0,x.BN)(e,{...r,tenIncorrectAnswers:!0,tenIncorrectAnswersDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u518d\u63a5\u518d\u53b2] \u6210\u5c31\uff01")),c>=50&&!t.fiftyIncorrectAnswers&&(await(0,x.BN)(e,{...r,fiftyIncorrectAnswers:!0,fiftyIncorrectAnswersDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u4e0d\u6015\u5931\u6557] \u6210\u5c31\uff01")),c>=100&&!t.hundredIncorrectAnswers&&(await(0,x.BN)(e,{...r,hundredIncorrectAnswers:!0,hundredIncorrectAnswersDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u8d8a\u632b\u8d8a\u52c7] \u6210\u5c31\uff01")),a>=100&&!t.hundredQuizzes&&(await(0,x.BN)(e,{...r,hundredQuizzes:!0,hundredQuizzesDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u5237\u984c\u9ad8\u624b] \u6210\u5c31\uff01")),a>=500&&!t.fiveHundredQuizzes&&(await(0,x.BN)(e,{...r,fiveHundredQuizzes:!0,fiveHundredQuizzesDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u5237\u984c\u9054\u4eba] \u6210\u5c31\uff01")),a>=1e3&&!t.thousandQuizzes&&(await(0,x.BN)(e,{...r,thousandQuizzes:!0,thousandQuizzesDate:(0,x.O5)()},{merge:!0}),M("\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [\u963f\u5f6c\u4ee3\u8a00\u4eba] \u6210\u5c31\uff01"))},[L,v,w.length]),M=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";_(e),H(s),E(!0)};(0,r.useEffect)(()=>{C&&L&&!L.isAnonymous&&T()},[C,L,T]);const P=(0,r.useCallback)(()=>{b(0),z(0),D(!1),p(y(t)),q([])},[t]),U=()=>({shareText:`\u6211\u5728 \uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\u4e2d\u7372\u5f97\u4e86 ${v} \u5206\uff01\u5feb\u4f86\u6311\u6230\u770b\u770b\u4f60\u7684\u5206\u6578\uff01`,shareUrl:window.location.href}),V="yeomsebeen_field.jpg";return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(n.mg,{children:[(0,f.jsx)("title",{children:"\uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\uff01"}),(0,f.jsx)("meta",{property:"og:title",content:"\uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\uff01"}),(0,f.jsx)("meta",{property:"og:description",content:"\u5feb\u4f86\u6311\u6230\u770b\u770b\u4f60\u5c0d\u5ec9\u4e16\u5f6c\u7684\u4e86\u89e3\u7a0b\u5ea6\uff01"}),(0,f.jsx)("meta",{property:"og:image",content:`https://storage.googleapis.com/yeom-se-been-fanpage-assets/${V}`}),(0,f.jsx)("meta",{property:"og:url",content:window.location.href}),(0,f.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,f.jsx)("meta",{name:"twitter:image",content:`https://storage.googleapis.com/yeom-se-been-fanpage-assets/${V}`})]}),(0,f.jsx)(c.A,{position:"top-end",className:"p-3",children:(0,f.jsxs)(o.A,{onClose:()=>E(!1),show:Q,delay:5e3,autohide:!0,bg:G,children:[(0,f.jsx)(o.A.Header,{children:(0,f.jsx)("strong",{className:"me-auto",children:"\u6210\u5c31\u89e3\u9396\uff01"})}),(0,f.jsx)(o.A.Body,{children:$})]})}),(0,f.jsxs)("div",{className:"fan-quiz-container",children:[(0,f.jsx)("h2",{children:"\uc5fc\uc138\u5f6c \u7c89\u7d72\u5c0f\u904a\u6232\uff01"}),S&&(0,f.jsxs)("div",{className:"text-center",children:[(0,f.jsx)(l.A,{animation:"border",variant:"light"}),(0,f.jsx)("p",{className:"text-white-50 mt-2",children:"\u8f09\u5165\u4e2d..."})]}),B&&(0,f.jsx)(d.A,{variant:"danger",children:B}),!S&&!B&&(C?(0,f.jsxs)("div",{className:"score-section",children:[(0,f.jsxs)("div",{className:"score-text",children:["\u4f60\u7372\u5f97\u4e86 ",v," \u5206\uff0c\u7e3d\u5206 ",w.length," \u5206\uff01"]}),L&&L.isAnonymous&&(0,f.jsx)(d.A,{variant:"info",className:"mt-3",style:{fontSize:"0.85em"},children:"\u60a8\u7684\u4f5c\u7b54\u7d50\u679c\u4e0d\u6703\u9032\u5165\u6392\u884c\u699c\u3002\u5982\u9700\u8a18\u9304\u5206\u6578\uff0c\u8acb\u4f7f\u7528 Google \u5e33\u6236\u767b\u5165\u3002"}),(0,f.jsxs)("div",{className:"score-buttons",children:[(0,f.jsx)("button",{onClick:()=>{const{shareText:e,shareUrl:s}=U(),t=`${e} ${s}`;navigator.clipboard.writeText(t).then(()=>{alert("\u5206\u4eab\u9023\u7d50\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f\uff01")}).catch(e=>{console.error("\u7121\u6cd5\u8907\u88fd\u5206\u4eab\u9023\u7d50:",e)})},className:"quiz-button share-link-button",children:(0,f.jsx)(a.ayE,{})}),(0,f.jsx)("button",{onClick:P,className:"quiz-button play-again-button",children:(0,f.jsx)(a.wO2,{})}),(0,f.jsx)("button",{onClick:()=>{const{shareText:e,shareUrl:s}=U(),t=`https://line.me/R/msg/text/?${encodeURIComponent(`${e} ${s}`)}`;window.open(t,"_blank")},className:"quiz-button share-line-button",children:(0,f.jsx)(i.y16,{})})]}),(0,f.jsxs)("div",{className:"quiz-answers-summary mt-4",children:[(0,f.jsx)("h3",{children:"\u4f5c\u7b54\u7d50\u679c"}),O.map((e,s)=>(0,f.jsxs)("div",{className:"answer-item mb-3 p-3 border rounded",children:[(0,f.jsxs)("p",{children:[(0,f.jsxs)("strong",{children:["\u554f\u984c ",s+1,":"]})," ",e.question]}),(0,f.jsxs)("p",{children:[(0,f.jsx)("strong",{children:"\u4f60\u7684\u7b54\u6848:"})," ",(0,f.jsx)("span",{style:{color:e.isCorrect?"#28a745":"#dc3545"},children:e.userAnswer})]}),!e.isCorrect&&(0,f.jsxs)("p",{children:[(0,f.jsx)("strong",{children:"\u6b63\u78ba\u7b54\u6848:"})," ",(0,f.jsx)("span",{style:{color:"#28a745"},children:e.correctAnswer})]})]},s))]})]}):w.length>0&&(0,f.jsxs)("div",{className:"question-section",children:[(0,f.jsxs)("div",{className:"question-count",children:[(0,f.jsxs)("span",{children:["\u554f\u984c ",N+1]}),"/",w.length]}),(0,f.jsx)("div",{className:"question-text",children:null===(e=w[N])||void 0===e?void 0:e.question}),(0,f.jsx)("div",{className:"answer-section",children:null===(s=w[N])||void 0===s?void 0:s.options.map((e,s)=>(0,f.jsx)(h.A,{onClick:()=>(e=>{const s=w[N],t=e===s.answer;t&&z(v+1),q(r=>[...r,{question:s.question,correctAnswer:s.answer,userAnswer:e,isCorrect:t}]);const r=N+1;if(r<w.length)b(r);else if(D(!0),L&&!L.isAnonymous){const e=(0,x.H9)(m.db,"userAchievements",L.uid),s=t?v+1:v,r={totalQuizSessions:(0,x.GV)(1),totalQuizzesAnswered:(0,x.GV)(w.length),totalCorrectAnswers:(0,x.GV)(s),totalIncorrectAnswers:(0,x.GV)(w.length-s)};(0,x.BN)(e,r,{merge:!0})}})(e),className:"answer-btn btn-theme-gradient w-100 mb-2",disabled:C,children:e},s))})]}))]}),(0,f.jsx)("div",{className:"leaderboard-section mt-5",children:(0,f.jsx)(u.A,{defaultActiveKey:"0",children:(0,f.jsxs)(u.A.Item,{eventKey:"0",children:[(0,f.jsx)(u.A.Header,{children:"\u6392\u884c\u699c"}),(0,f.jsx)(u.A.Body,{children:(0,f.jsx)(A,{})})]})})})]})}}}]);
//# sourceMappingURL=580.05e10664.chunk.js.map