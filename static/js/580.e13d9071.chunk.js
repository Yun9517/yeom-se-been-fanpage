"use strict";(self.webpackChunkyeom_se_been_fanpage=self.webpackChunkyeom_se_been_fanpage||[]).push([[580],{1131:(e,s,t)=>{t.d(s,{A:()=>i});var n=t(5043),r=t(6667),a=t(791);const i=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const[i,o]=(0,n.useState)([]),[c,l]=(0,n.useState)(!0),[d,h]=(0,n.useState)(null);return(0,n.useEffect)(()=>{l(!0),h(null);const n=(0,r.rJ)(a.db,e);let i=(0,r.P)(n,...s);let c=null;return t?c=(0,r.aQ)(i,s=>{const t=s.docs.map(e=>({id:e.id,...e.data()}));o(t),l(!1),h(null),console.log(`useFirestoreCollection: Live update from ${e}.`)},s=>{console.error(`useFirestoreCollection: Live update error for ${e}:`,s),h(`\u5373\u6642\u66f4\u65b0 ${e} \u8cc7\u6599\u5931\u6557\u3002`),l(!1)}):(async()=>{try{const s=(await(0,r.GG)(i)).docs.map(e=>({id:e.id,...e.data()}));o(s),console.log(`useFirestoreCollection: Fetched data from ${e}.`)}catch(s){console.error(`useFirestoreCollection: Error fetching data from ${e}:`,s),h(`\u7121\u6cd5\u8f09\u5165 ${e} \u8cc7\u6599\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u3002`)}finally{l(!1)}})(),()=>{c&&c()}},[e,s,t]),{data:i,loading:c,error:d}}},6580:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var n=t(5043),r=t(9367),a=t(5200),i=t(184),o=t(4524),c=t(1089),l=t(1719),d=t(4282),h=t(457),u=t(791),m=t(6667),x=t(8279),j=t(5258),g=t(4196),w=t(6045),f=t(1131),A=t(579);const y=()=>{const[e]=(0,x.hD)(u.j),[s,t]=(0,n.useState)(10),[r,a]=(0,n.useState)(1),o=(0,n.useMemo)(()=>[(0,m.My)("score","desc")],[]),{data:c,loading:l,error:h}=(0,f.A)("scores",o,!0),[y,p]=(0,n.useState)([]);(0,n.useEffect)(()=>{const e=(r-1)*s,t=e+s;p(c.slice(e,t))},[c,r,s]);const v=Math.ceil(c.length/s),b=e=>{const t=(r-1)*s+e;return 0===t?"rank-gold":1===t?"rank-silver":2===t?"rank-bronze":""};return(0,A.jsxs)("div",{className:"leaderboard-container mt-5",children:[(0,A.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,A.jsx)("h2",{className:"leaderboard-title mb-0",children:"\u6392\u884c\u699c"}),(0,A.jsxs)(j.A,{children:[(0,A.jsxs)(j.A.Toggle,{id:"dropdown-pagesize",size:"sm",className:"btn-theme-gradient",children:["\u6bcf\u9801 ",s," \u7b46"]}),(0,A.jsxs)(j.A.Menu,{children:[(0,A.jsx)(j.A.Item,{onClick:()=>t(10),children:"10"}),(0,A.jsx)(j.A.Item,{onClick:()=>t(20),children:"20"}),(0,A.jsx)(j.A.Item,{onClick:()=>t(50),children:"50"}),(0,A.jsx)(j.A.Item,{onClick:()=>t(100),children:"100"})]})]})]}),(0,A.jsxs)(g.A,{striped:!0,bordered:!0,responsive:!0,variant:"dark",children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("th",{children:"#"}),(0,A.jsx)("th",{children:"\u73a9\u5bb6"}),(0,A.jsx)("th",{children:"\u5206\u6578"}),(0,A.jsx)("th",{children:"\u65e5\u671f"})]})}),(0,A.jsx)("tbody",{children:l?(0,A.jsx)("tr",{children:(0,A.jsx)("td",{colSpan:"4",className:"text-center",children:(0,A.jsx)(w.A,{loading:l})})}):y.map((t,n)=>{var a;return(0,A.jsxs)("tr",{className:`${b((r-1)*s+n)} ${e&&t.userId===e.uid?"current-user-row":""}`,children:[(0,A.jsx)("td",{className:"rank-cell",children:(r-1)*s+n+1<=3?(0,A.jsx)(i.SBv,{className:"trophy-icon"}):(r-1)*s+n+1}),(0,A.jsx)("td",{children:t.userName}),(0,A.jsx)("td",{children:t.score}),(0,A.jsx)("td",{children:new Date(null===(a=t.createdAt)||void 0===a?void 0:a.toDate()).toLocaleDateString()})]},t.id)})})]}),(0,A.jsxs)("div",{className:"d-flex justify-content-between mt-3",children:[r>1&&(0,A.jsx)(d.A,{onClick:()=>{r>1&&a(e=>e-1)},disabled:l,variant:"secondary",children:"\u4e0a\u4e00\u9801"}),r<v&&(0,A.jsx)(d.A,{onClick:()=>{r<v&&a(e=>e+1)},disabled:l,variant:"secondary",className:"ms-auto",children:"\u4e0b\u4e00\u9801"})]})]})};var p=t(6481);const v=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return[...e].sort(()=>.5-Math.random()).slice(0,s)};const b=function(){var e,s;const[t,j]=(0,n.useState)([]),[g,b]=(0,n.useState)(0),[N,C]=(0,n.useState)(0),[z,k]=(0,n.useState)(!1),[S,$]=(0,n.useState)([]),[I]=(0,x.hD)(u.j),[q,D]=(0,n.useState)(!1),[L,Q]=(0,n.useState)(""),[_,E]=(0,n.useState)("success"),G=(0,n.useMemo)(()=>[],[]),{data:M,loading:F,error:H}=(0,f.A)("quizzes",G);(0,n.useEffect)(()=>{!F&&!H&&M.length>0&&j(v(M))},[M,F,H]),(0,n.useEffect)(()=>{(async()=>{if(z&&I&&!I.isAnonymous)try{await(0,m.gS)((0,m.rJ)(u.db,"scores"),{userName:I.displayName,userId:I.uid,score:N,userAnswers:S,createdAt:(0,m.O5)()})}catch(e){console.error("Error adding document: ",e)}})()},[z,I,N,S]);const T=(0,n.useCallback)(async()=>{if(!I||I.isAnonymous)return;const e=(0,m.H9)(u.db,"userAchievements",I.uid),s=await(0,m.x7)(e),n=s.exists()?s.data():{},r={userName:I.displayName,userEmail:I.email},a=async s=>{const t=p.vd.find(e=>e.id===s);if(!t)return;const n=p.M9.oneTime[t.tier]||0;await(0,m.BN)(e,{...r,[s]:!0,[`${s}Date`]:(0,m.O5)(),points:(0,m.GV)(n)},{merge:!0}),B(`\u606d\u559c\uff01\u60a8\u89e3\u9396\u4e86 [${t.name}] \u6210\u5c31\uff01\u7372\u5f97 ${n} \u9ede\uff01`)};N!==t.length||n.firstPerfectScore||await a("firstPerfectScore"),0!==N||n.firstAllWrong||await a("firstAllWrong");const i=n.loginDaysCount||0;i>=1&&!n.firstLogin&&await a("firstLogin"),i>=3&&!n.threeDayLogin&&await a("threeDayLogin"),i>=7&&!n.sevenDayLogin&&await a("sevenDayLogin"),i>=30&&!n.thirtyDayLogin&&await a("thirtyDayLogin");const o=n.totalQuizzesAnswered||0,c=n.totalCorrectAnswers||0,l=n.totalIncorrectAnswers||0;c>=10&&!n.tenCorrectAnswers&&await a("tenCorrectAnswers"),c>=50&&!n.fiftyCorrectAnswers&&await a("fiftyCorrectAnswers"),c>=100&&!n.hundredCorrectAnswers&&await a("hundredCorrectAnswers"),l>=10&&!n.tenIncorrectAnswers&&await a("tenIncorrectAnswers"),l>=50&&!n.fiftyIncorrectAnswers&&await a("fiftyIncorrectAnswers"),l>=100&&!n.hundredIncorrectAnswers&&await a("hundredIncorrectAnswers"),o>=100&&!n.hundredQuizzes&&await a("hundredQuizzes"),o>=500&&!n.fiveHundredQuizzes&&await a("fiveHundredQuizzes"),o>=1e3&&!n.thousandQuizzes&&await a("thousandQuizzes")},[I,N,t.length]),B=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";Q(e),E(s),D(!0)};(0,n.useEffect)(()=>{z&&I&&!I.isAnonymous&&T()},[z,I,T]);const V=(0,n.useCallback)(()=>{b(0),C(0),k(!1),j(v(M)),$([])},[M]),U=()=>({shareText:`\u6211\u5728 \uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\u4e2d\u7372\u5f97\u4e86 ${N} \u5206\uff01\u5feb\u4f86\u6311\u6230\u770b\u770b\u4f60\u7684\u5206\u6578\uff01`,shareUrl:window.location.href}),O="yeomsebeen_field.jpg";return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(r.mg,{children:[(0,A.jsx)("title",{children:"\uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\uff01"}),(0,A.jsx)("meta",{property:"og:title",content:"\uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\uff01"}),(0,A.jsx)("meta",{property:"og:description",content:"\u5feb\u4f86\u6311\u6230\u770b\u770b\u4f60\u5c0d\u5ec9\u4e16\u5f6c\u7684\u4e86\u89e3\u7a0b\u5ea6\uff01"}),(0,A.jsx)("meta",{property:"og:image",content:`https://storage.googleapis.com/yeom-se-been-fanpage-assets/${O}`}),(0,A.jsx)("meta",{property:"og:url",content:window.location.href}),(0,A.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,A.jsx)("meta",{name:"twitter:image",content:`https://storage.googleapis.com/yeom-se-been-fanpage-assets/${O}`})]}),(0,A.jsx)(o.A,{position:"top-end",className:"p-3",children:(0,A.jsxs)(c.A,{onClose:()=>D(!1),show:q,bg:_,children:[(0,A.jsx)(c.A.Header,{children:(0,A.jsx)("strong",{className:"me-auto",children:"\u6210\u5c31\u89e3\u9396\uff01"})}),(0,A.jsx)(c.A.Body,{children:L})]})}),(0,A.jsxs)("div",{className:"fan-quiz-container",children:[(0,A.jsx)("h2",{children:"\uc5fc\uc138\u5f6c \u7c89\u7d72\u5c0f\u904a\u6232\uff01"}),F&&(0,A.jsx)(w.A,{loading:F}),H&&(0,A.jsx)(l.A,{variant:"danger",children:H}),!F&&!H&&(z?(0,A.jsxs)("div",{className:"score-section",children:[(0,A.jsxs)("div",{className:"score-text",children:["\u4f60\u7372\u5f97\u4e86 ",N," \u5206\uff0c\u7e3d\u5206 ",t.length," \u5206\uff01"]}),(!I||I.isAnonymous)&&(0,A.jsx)(l.A,{variant:"info",className:"mt-3",style:{fontSize:"0.65em"},children:"\u60a8\u7684\u4f5c\u7b54\u7d50\u679c\u4e0d\u6703\u9032\u5165\u6392\u884c\u699c\u3002\u5982\u9700\u8a18\u9304\u5206\u6578\uff0c\u8acb\u4f7f\u7528 Google \u5e33\u6236\u767b\u5165\u3002"}),(0,A.jsxs)("div",{className:"score-buttons",children:[(0,A.jsx)("button",{onClick:()=>{const{shareText:e,shareUrl:s}=U(),t=`${e} ${s}`;navigator.clipboard.writeText(t).then(()=>{alert("\u5206\u4eab\u9023\u7d50\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f\uff01")}).catch(e=>{console.error("\u7121\u6cd5\u8907\u88fd\u5206\u4eab\u9023\u7d50:",e)})},className:"quiz-button share-link-button",children:(0,A.jsx)(a.ayE,{})}),(0,A.jsx)("button",{onClick:V,className:"quiz-button play-again-button",children:(0,A.jsx)(a.wO2,{})}),(0,A.jsx)("button",{onClick:()=>{const{shareText:e,shareUrl:s}=U(),t=`https://line.me/R/msg/text/?${encodeURIComponent(`${e} ${s}`)}`;window.open(t,"_blank")},className:"quiz-button share-line-button",children:(0,A.jsx)(i.y16,{})})]}),(0,A.jsxs)("div",{className:"quiz-answers-summary mt-4",children:[(0,A.jsx)("h3",{children:"\u4f5c\u7b54\u7d50\u679c"}),S.map((e,s)=>(0,A.jsxs)("div",{className:"answer-item mb-3 p-3 border rounded",children:[(0,A.jsxs)("p",{children:[(0,A.jsxs)("strong",{children:["\u554f\u984c ",s+1,":"]})," ",e.question]}),(0,A.jsxs)("p",{children:[(0,A.jsx)("strong",{children:"\u4f60\u7684\u7b54\u6848:"})," ",(0,A.jsx)("span",{style:{color:e.isCorrect?"#28a745":"#dc3545"},children:e.userAnswer})]}),!e.isCorrect&&(0,A.jsxs)("p",{children:[(0,A.jsx)("strong",{children:"\u6b63\u78ba\u7b54\u6848:"})," ",(0,A.jsx)("span",{style:{color:"#28a745"},children:e.correctAnswer})]})]},s))]})]}):t.length>0&&(0,A.jsxs)("div",{className:"question-section",children:[(0,A.jsxs)("div",{className:"question-count",children:[(0,A.jsxs)("span",{children:["\u554f\u984c ",g+1]}),"/",t.length]}),(0,A.jsx)("div",{className:"question-text",children:null===(e=t[g])||void 0===e?void 0:e.question}),(0,A.jsx)("div",{className:"answer-section",children:null===(s=t[g])||void 0===s?void 0:s.options.map((e,s)=>(0,A.jsx)(d.A,{onClick:()=>(e=>{const s=t[g],n=e===s.answer;n&&C(N+1),$(t=>[...t,{question:s.question,correctAnswer:s.answer,userAnswer:e,isCorrect:n}]);const r=g+1;if(r<t.length)b(r);else if(k(!0),I&&!I.isAnonymous){const e=(0,m.H9)(u.db,"userAchievements",I.uid),s=n?N+1:N,r={totalQuizSessions:(0,m.GV)(1),totalQuizzesAnswered:(0,m.GV)(t.length),totalCorrectAnswers:(0,m.GV)(s),totalIncorrectAnswers:(0,m.GV)(t.length-s)};(0,m.BN)(e,r,{merge:!0})}})(e),className:"answer-btn btn-theme-gradient w-100 mb-2",disabled:z,children:e},s))})]}))]}),(0,A.jsx)("div",{className:"leaderboard-section mt-5",children:(0,A.jsx)(h.A,{defaultActiveKey:"0",children:(0,A.jsxs)(h.A.Item,{eventKey:"0",children:[(0,A.jsx)(h.A.Header,{children:"\u6392\u884c\u699c"}),(0,A.jsx)(h.A.Body,{children:(0,A.jsx)(y,{})})]})})})]})}}}]);
//# sourceMappingURL=580.e13d9071.chunk.js.map