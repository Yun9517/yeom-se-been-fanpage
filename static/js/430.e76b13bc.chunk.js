"use strict";(self.webpackChunkyeom_se_been_fanpage=self.webpackChunkyeom_se_been_fanpage||[]).push([[430],{5430:(e,s,n)=>{n.r(s),n.d(s,{default:()=>D});var r=n(5043),t=n(791),a=n(6667),l=n(8279),i=n(3519),c=n(7417),d=n(1719),o=n(1072),x=n(8602),h=n(9437),j=n(8139),u=n.n(j),m=n(7852),A=n(1068),p=n(9334),g=n(579);const f=r.forwardRef((e,s)=>{let{className:n,bsPrefix:r,as:t="span",...a}=e;return r=(0,m.oU)(r,"input-group-text"),(0,g.jsx)(t,{ref:s,className:u()(n,r),...a})});f.displayName="InputGroupText";const v=f,y=r.forwardRef((e,s)=>{let{bsPrefix:n,size:t,hasValidation:a,className:l,as:i="div",...c}=e;n=(0,m.oU)(n,"input-group");const d=(0,r.useMemo)(()=>({}),[]);return(0,g.jsx)(p.A.Provider,{value:d,children:(0,g.jsx)(i,{ref:s,...c,className:u()(l,n,t&&`${n}-${t}`,a&&"has-validation")})})});y.displayName="InputGroup";const b=Object.assign(y,{Text:v,Radio:e=>(0,g.jsx)(v,{children:(0,g.jsx)(A.A,{type:"radio",...e})}),Checkbox:e=>(0,g.jsx)(v,{children:(0,g.jsx)(A.A,{type:"checkbox",...e})})});var N=n(6522),w=n(4282),C=n(4196),S=n(457),k=n(184);const D=()=>{const[e,s]=(0,l.hD)(t.j),[n,j]=(0,r.useState)([]),[u,m]=(0,r.useState)({}),[A,p]=(0,r.useState)(!0),[f,v]=(0,r.useState)(null),[y,D]=(0,r.useState)(""),[I,P]=(0,r.useState)("createdAt"),[z,_]=(0,r.useState)("desc"),[T,M]=(0,r.useState)(1),[G,E]=(0,r.useState)(10),[H,q]=(0,r.useState)(null),[O,R]=(0,r.useState)([null]),[B,F]=(0,r.useState)(!1),[K,L]=(0,r.useState)(""),[U,$]=(0,r.useState)(""),[J,Q]=(0,r.useState)(""),[V,W]=(0,r.useState)(""),[X,Y]=(0,r.useState)("");(0,r.useEffect)(()=>{e?(M(1),q(null),R([null]),F(!1),v(null)):(j([]),p(!1),v("\u8acb\u5148\u767b\u5165\u4ee5\u67e5\u770b\u904a\u6232\u7d00\u9304\u3002"),M(1),q(null),R([null]),F(!1))},[e]),(0,r.useEffect)(()=>{(async()=>{if(!s&&e){p(!0);try{const s=(0,a.H9)(t.db,"userAchievements",e.uid),n=await(0,a.x7)(s);m(n.exists()?n.data():{});let r=(0,a.rJ)(t.db,"scores"),l=(0,a.P)(r,(0,a._M)("userId","==",e.uid));if(V){const e=a.Dc.fromDate(new Date(V+"T00:00:00"));l=(0,a.P)(l,(0,a._M)("createdAt",">=",e))}if(X){const e=a.Dc.fromDate(new Date(X+"T23:59:59"));l=(0,a.P)(l,(0,a._M)("createdAt","<=",e))}l=(0,a.P)(l,(0,a.My)(I,z)),O[T-1]&&(l=(0,a.P)(l,(0,a.HM)(O[T-1]))),l=(0,a.P)(l,(0,a.AB)(G+1));const i=await(0,a.GG)(l),c=i.docs.map(e=>({id:e.id,...e.data()}));F(c.length>G);const d=c.slice(0,G);j(d),q(i.docs[d.length-1])}catch(n){console.error("Error fetching quiz history:",n),v("\u7121\u6cd5\u8f09\u5165\u904a\u6232\u7d00\u9304\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u3002")}finally{p(!1)}}})()},[e,s,I,z,T,G,V,X,O]);const Z=e=>{e===I?_("asc"===z?"desc":"asc"):(P(e),_("desc")),M(1),q(null),R([null]),F(!1)},ee=e=>{E(e),M(1),q(null),R([null]),F(!1)},se=()=>{const e=parseInt(K,10);e>0?ee(e):D("\u8acb\u8f38\u5165\u6709\u6548\u7684\u6578\u5b57\u3002")};if(s)return(0,g.jsxs)(i.A,{className:"mt-5 text-center",children:[(0,g.jsx)(c.A,{animation:"border",variant:"light"}),(0,g.jsx)("p",{className:"text-white-50 mt-2",children:"\u8f09\u5165\u4f7f\u7528\u8005\u72c0\u614b..."})]});if(A)return(0,g.jsxs)(i.A,{className:"mt-5 text-center",children:[(0,g.jsx)(c.A,{animation:"border",variant:"light"}),(0,g.jsx)("p",{className:"text-white-50 mt-2",children:"\u8f09\u5165\u904a\u6232\u7d00\u9304\u4e2d..."})]});if(f)return(0,g.jsx)(i.A,{className:"mt-5",children:(0,g.jsx)(d.A,{variant:"danger",children:f})});if(!e)return(0,g.jsx)(i.A,{className:"mt-5",children:(0,g.jsx)(d.A,{variant:"info",children:"\u8acb\u767b\u5165\u4ee5\u67e5\u770b\u60a8\u7684\u904a\u6232\u7d00\u9304\u3002"})});if(e.isAnonymous)return(0,g.jsx)(i.A,{className:"mt-5",children:(0,g.jsx)(d.A,{variant:"info",children:"\u60a8\u76ee\u524d\u4ee5\u8a2a\u5ba2\u6a21\u5f0f\u767b\u5165\u3002\u5982\u9700\u67e5\u770b\u4e26\u5132\u5b58\u904a\u6232\u7d00\u9304\uff0c\u8acb\u4f7f\u7528 Google \u5e33\u6236\u767b\u5165\u3002"})});const ne=u.totalQuizSessions||0,re=n.reduce((e,s)=>Math.max(e,s.score),0),te=n.length>0?(n.reduce((e,s)=>e+s.score,0)/n.length).toFixed(2):0;return(0,g.jsxs)(i.A,{className:"mt-5 leaderboard-container",children:[(0,g.jsx)("h2",{children:"\u6211\u7684\u904a\u6232\u7d00\u9304"}),(0,g.jsx)("div",{className:"p-3 rounded mb-3",style:{backgroundColor:"#343a40"},children:(0,g.jsxs)(o.A,{className:"align-items-center gy-3",children:[" ",(0,g.jsx)(x.A,{md:6,style:{color:"#e9ecef"},children:(0,g.jsxs)(o.A,{children:[(0,g.jsx)(x.A,{xs:12,children:(0,g.jsxs)("p",{className:"mb-1",children:[(0,g.jsx)("strong",{children:"\u7e3d\u904a\u6232\u6b21\u6578:"})," ",ne]})}),(0,g.jsx)(x.A,{xs:12,children:(0,g.jsxs)("p",{className:"mb-1",children:[(0,g.jsx)("strong",{children:"\u672c\u9801\u904a\u6232\u6b21\u6578:"})," ",n.length]})}),(0,g.jsx)(x.A,{xs:12,children:(0,g.jsxs)("p",{className:"mb-1",children:[(0,g.jsx)("strong",{children:"\u6700\u9ad8\u5206\u6578 (\u672c\u9801):"})," ",re]})}),(0,g.jsx)(x.A,{xs:12,children:(0,g.jsxs)("p",{className:"mb-0",children:[(0,g.jsx)("strong",{children:"\u5e73\u5747\u5206\u6578 (\u672c\u9801):"})," ",te]})})]})}),(0,g.jsx)(x.A,{md:6,className:"filter-controls",children:(0,g.jsxs)("div",{className:"d-flex flex-column",children:[(0,g.jsxs)(h.A,{className:"w-100 mb-2",children:[(0,g.jsxs)(h.A.Toggle,{variant:"primary",id:"dropdown-items-per-page",size:"sm",className:"w-100",children:["\u6bcf\u9801\u986f\u793a: ",G]}),(0,g.jsxs)(h.A.Menu,{className:"w-100",children:[(0,g.jsx)(h.A.Item,{onClick:()=>ee(10),children:"10"}),(0,g.jsx)(h.A.Item,{onClick:()=>ee(20),children:"20"}),(0,g.jsx)(h.A.Item,{onClick:()=>ee(50),children:"50"}),(0,g.jsx)(h.A.Divider,{}),(0,g.jsx)(h.A.Item,{as:"div",onClick:e=>e.stopPropagation(),children:(0,g.jsxs)(b,{size:"sm",className:"p-2",children:[(0,g.jsx)(N.A.Control,{type:"number",placeholder:"\u81ea\u8a02",value:K,onChange:e=>L(e.target.value),onKeyPress:e=>{"Enter"===e.key&&se()}}),(0,g.jsx)(w.A,{variant:"outline-secondary",onClick:se,children:"\u8a2d\u5b9a"})]})})]})]}),(0,g.jsxs)(b,{size:"sm",className:"mb-2",children:[(0,g.jsx)(b.Text,{children:"\u958b\u59cb"}),(0,g.jsx)(N.A.Control,{type:"date",value:U,onChange:e=>$(e.target.value),max:(new Date).toISOString().split("T")[0]})]}),(0,g.jsxs)(b,{size:"sm",className:"mb-2",children:[(0,g.jsx)(b.Text,{children:"\u7d50\u675f"}),(0,g.jsx)(N.A.Control,{type:"date",value:J,onChange:e=>Q(e.target.value),max:(new Date).toISOString().split("T")[0]})]}),(0,g.jsxs)("div",{className:"d-flex justify-content-end",children:[(0,g.jsx)(w.A,{variant:"primary",onClick:()=>{D(""),U||J?U&&J&&new Date(U)>new Date(J)?D("\u958b\u59cb\u65e5\u671f\u4e0d\u80fd\u665a\u65bc\u7d50\u675f\u65e5\u671f\u3002"):(W(U),Y(J),M(1),q(null),R([null]),F(!1)):D("\u8acb\u81f3\u5c11\u9078\u64c7\u4e00\u500b\u958b\u59cb\u6216\u7d50\u675f\u65e5\u671f\u3002")},className:"me-2",size:"sm",children:"\u7be9\u9078"}),(0,g.jsx)(w.A,{variant:"outline-secondary",onClick:()=>{$(""),Q(""),W(""),Y(""),D(""),M(1),q(null),R([null]),F(!1)},size:"sm",children:"\u6e05\u9664"})]})]})})]})}),y&&(0,g.jsx)(d.A,{variant:"warning",onClose:()=>D(""),dismissible:!0,children:y}),0!==n.length||A?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(C.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,variant:"dark",style:{tableLayout:"fixed",wordWrap:"break-word"},children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsxs)("th",{onClick:()=>Z("createdAt"),style:{cursor:"pointer",width:"25%"},children:["\u65e5\u671f ","createdAt"===I&&("asc"===z?"\u25b2":"\u25bc")]}),(0,g.jsxs)("th",{onClick:()=>Z("score"),style:{cursor:"pointer",width:"20%"},children:["\u5206\u6578 ","score"===I&&("asc"===z?"\u25b2":"\u25bc")]}),(0,g.jsx)("th",{style:{width:"55%"},children:"\u4f5c\u7b54\u7d50\u679c"})]})}),(0,g.jsx)("tbody",{children:n.map(e=>{var s;return(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:null===(s=e.createdAt)||void 0===s?void 0:s.toDate().toLocaleDateString()}),(0,g.jsx)("td",{children:e.score}),(0,g.jsx)("td",{children:(0,g.jsx)(S.A,{className:"quiz-history-accordion",children:(0,g.jsxs)(S.A.Item,{eventKey:"0",children:[(0,g.jsx)(S.A.Header,{children:"\u67e5\u770b\u8a73\u60c5"}),(0,g.jsx)(S.A.Body,{children:e.userAnswers&&e.userAnswers.length>0?e.userAnswers.map((e,s)=>(0,g.jsxs)("div",{className:"mb-2 p-2 border rounded",children:[(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"\u554f\u984c:"})," ",e.question]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"\u4f60\u7684\u7b54\u6848:"})," ",(0,g.jsxs)("span",{style:{color:e.isCorrect?"#28a745":"#dc3545"},children:[e.userAnswer," ",e.isCorrect?(0,g.jsx)(k.A7C,{color:"#28a745"}):(0,g.jsx)(k._Hm,{color:"#dc3545"})]})]}),!e.isCorrect&&(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"\u6b63\u78ba\u7b54\u6848:"})," ",(0,g.jsx)("span",{style:{color:"#28a745"},children:e.correctAnswer})]})]},s)):(0,g.jsx)("p",{children:"\u7121\u8a73\u7d30\u4f5c\u7b54\u7d50\u679c\u3002"})})]})})})]},e.id)})})]}),(0,g.jsxs)("div",{className:"d-flex justify-content-between mt-3",children:[T>1&&(0,g.jsx)(w.A,{onClick:()=>{if(T>1){M(e=>e-1);const e=[...O];e.pop(),R(e),q(e[e.length-1])}},disabled:A,variant:"secondary",children:"\u4e0a\u4e00\u9801"}),B&&(0,g.jsx)(w.A,{onClick:()=>{B&&(M(e=>e+1),R(e=>[...e,H]))},disabled:A,variant:"secondary",className:"ms-auto",children:"\u4e0b\u4e00\u9801"})]})]}):(0,g.jsx)(d.A,{variant:"info",children:"\u60a8\u9084\u6c92\u6709\u4efb\u4f55\u904a\u6232\u7d00\u9304\u3002"})]})}}}]);
//# sourceMappingURL=430.e76b13bc.chunk.js.map