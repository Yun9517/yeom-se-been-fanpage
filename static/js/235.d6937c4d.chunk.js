"use strict";(self.webpackChunkyeom_se_been_fanpage=self.webpackChunkyeom_se_been_fanpage||[]).push([[235],{1290:(e,s,t)=>{t.d(s,{A:()=>o});var n=t(5043),a=t(6667),i=t(791);const o=(e,s)=>{const[t,o]=(0,n.useState)(null),[c,l]=(0,n.useState)(!0),[r,d]=(0,n.useState)(null);return(0,n.useEffect)(()=>{(async()=>{l(!0),d(null);try{const t=(0,a.H9)(i.db,e,s),n=await(0,a.x7)(t);n.exists()?(o(n.data()),console.log(`useFirestoreDocument: Fetched data for ${e}/${s}.`)):(o(null),console.log(`useFirestoreDocument: No document found for ${e}/${s}.`))}catch(t){console.error(`useFirestoreDocument: Error fetching document ${e}/${s}:`,t),d(`\u7121\u6cd5\u8f09\u5165 ${e} \u5167\u5bb9\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u3002`)}finally{l(!1)}})()},[e,s]),{data:t,loading:c,error:r}}},2616:(e,s,t)=>{t.r(s),t.d(s,{default:()=>g});var n=t(5043),a=t(2678),i=t(791),o=t(6667),c=t(1048),l=t(184),r=t(579);const d=e=>{let{chats:s,activeChatId:t,onSelectChat:n,onNewChat:a,onDeleteChat:i,isOpen:o}=e;return(0,r.jsxs)("div",{className:"chat-history-sidebar "+(o?"open":""),children:[(0,r.jsx)("button",{onClick:a,className:"new-chat-btn",children:"+ \u65b0\u589e\u5c0d\u8a71"}),(0,r.jsx)("ul",{className:"chat-history-list",children:s.map(e=>(0,r.jsxs)("li",{className:"chat-history-item "+(e.id===t?"active":""),onClick:()=>n(e.id),children:[(0,r.jsx)("span",{className:"chat-item-title",title:e.title,children:e.title}),(0,r.jsx)("button",{className:"delete-chat-btn",onClick:s=>{s.stopPropagation(),i(e.id)},title:"\u522a\u9664\u5c0d\u8a71",children:(0,r.jsx)(l.qbC,{})})]},e.id))})]})},u=e=>{let{messages:s,onSendMessage:t,isLoading:a,activeChatId:i,onToggleSidebar:o}=e;const[c,d]=(0,n.useState)(""),u=(0,n.useRef)(null);(0,n.useEffect)(()=>{u.current&&u.current.scrollIntoView({behavior:"smooth"})},[s]),(0,n.useEffect)(()=>{i||d("")},[i]);const h=()=>{""!==c.trim()&&(t(c),d(""))};return(0,r.jsxs)("div",{className:"chat-window-main",children:[(0,r.jsxs)("div",{className:"beentalk-header",children:[(0,r.jsx)("button",{className:"sidebar-toggle-btn",onClick:o,children:(0,r.jsx)(l.OXb,{})}),(0,r.jsx)("h2",{children:"\u5f6cTalk"}),(0,r.jsx)("p",{children:"\u6709\u60f3\u77e5\u9053\u7684\u90fd\u7b49\u4f60\u4f86\u554f\uff01"})]}),(0,r.jsxs)("div",{className:"beentalk-messages",ref:u,children:[s.map((e,s)=>(0,r.jsx)("div",{className:`message ${e.sender}`,children:e.text},s)),a&&(0,r.jsx)("div",{className:"message bot",children:"\u8acb\u7a0d\u7b49..."})]}),(0,r.jsxs)("div",{className:"beentalk-input-area",children:[(0,r.jsx)("input",{type:"text",value:c,onChange:e=>{d(e.target.value)},onKeyPress:e=>{"Enter"!==e.key||a||h()},placeholder:"\u8f38\u5165\u4f60\u60f3\u554f\u7684\u554f\u984c...",disabled:a}),(0,r.jsx)("button",{onClick:h,disabled:a,className:"btn btn-theme-gradient",children:"\u50b3\u9001"})]})]})};var h=t(6045),m=t(1290);const g=()=>{const{user:e,authLoading:s}=(0,a.J)(),[t,l]=(0,n.useState)([]),[g,b]=(0,n.useState)(null),[x,f]=(0,n.useState)([]),[j,v]=(0,n.useState)(!1),[p,y]=(0,n.useState)(null),[C,S]=(0,n.useState)(!1),{data:N,loading:k,error:w}=(0,m.A)("pages","about");(0,n.useEffect)(()=>{const e="AIzaSyApnG7hMqjd5XRgoEkWSiSWny75or1WzhQ";if(e){const s=new c.ij(e);y(s)}},[]),(0,n.useEffect)(()=>{if(!e||e.isAnonymous)return l([]),b(null),void f([]);const s=(0,o.P)((0,o.rJ)(i.db,"users",e.uid,"chats"),(0,o.My)("createdAt","desc")),t=(0,o.aQ)(s,e=>{const s=e.docs.map(e=>({id:e.id,...e.data()}));l(s)});let n=()=>{};return g?n=(0,o.aQ)((0,o.H9)(i.db,"users",e.uid,"chats",g),e=>{e.exists()&&f(e.data().messages||[])}):f([]),()=>{t(),n()}},[e,g]);const $=e=>{b(e),S(!1)},A=()=>{b(null),f([]),S(!1)},E=async s=>{e&&!e.isAnonymous&&s&&window.confirm("\u60a8\u78ba\u5b9a\u8981\u522a\u9664\u9019\u6bb5\u5c0d\u8a71\u55ce\uff1f")&&(await(0,o.kd)((0,o.H9)(i.db,"users",e.uid,"chats",s)),g===s&&A())},T=async s=>{const t=!e||e.isAnonymous;if(!p||!t&&k)return;const n={sender:"user",text:s};v(!0);const a=[...x,n];f(a);const c=p.getGenerativeModel({model:"gemini-1.5-flash"});let l="";N&&(l=`\n\u4ee5\u4e0b\u662f\u7db2\u7ad9\u95dc\u65bc\u5ec9\u4e16\u5f6c\u7684\u4ecb\u7d39\u5167\u5bb9\uff0c\u8acb\u53c3\u8003\u9019\u4e9b\u8cc7\u8a0a\u4f86\u56de\u7b54\u554f\u984c\uff1a\n${N.section2022Title}: ${N.section2022Content}\n${N.section2023Title}: ${N.section2023Content}\n${N.section2025Title}: ${N.section2025Content}\n`);const r=`\u4f60\u662f\u4e00\u4f4d\u71b1\u60c5\u4e14\u6a02\u65bc\u52a9\u4eba\u7684\u52a9\u7406\uff0c\u4e5f\u662f\u5566\u5566\u968a\u54e1\u5ec9\u4e16\u5f6c\uff08\u5ec9\u4e16\u5f6c\uff09\u7684\u8d85\u7d1a\u7c89\u7d72\u3002\u4f60\u7684\u76ee\u6a19\u662f\u7cbe\u7c21\u7684\u56de\u7b54\u6709\u95dc\u5979\u7684\u554f\u984c\u3002\u5982\u679c\u554f\u984c\u8207\u5979\u7121\u95dc\uff0c\u8acb\u79ae\u8c8c\u5730\u62d2\u7d55\u4e26\u5c07\u8a71\u984c\u5f15\u5c0e\u56de\u5ec9\u4e16\u5f6c\u3002 ${t?"\u5728\u56de\u7b54\u5b8c\u554f\u984c\u5f8c\uff0c\u8acb\u7528\u53cb\u5584\u4e14\u7c21\u77ed\u7684\u8a9e\u6c23\uff0c\u6eab\u99a8\u5730\u63d0\u9192\u4f7f\u7528\u8005\u300c\u767b\u5165\u5f8c\u5c31\u53ef\u4ee5\u4fdd\u5b58\u6211\u5011\u7684\u5c0d\u8a71\u7d00\u9304\u5594\uff01\u300d\uff0c\u4f46\u5982\u679c\u4f7f\u7528\u8005\u53ea\u662f\u7c21\u55ae\u554f\u5019(\u4f8b\u5982:\u4f60\u597d)\uff0c\u5247\u4e0d\u9700\u63d0\u9192\u3002":""}\n\n${l}\n\n\u554f\u984c\uff1a${s}`;try{const t=await c.generateContent(r),n=await t.response,l={sender:"bot",text:n.text()},d=[...a,l];if(f(d),e&&!e.isAnonymous){let t=g;if(t){const s=(0,o.H9)(i.db,"users",e.uid,"chats",t);await(0,o.mZ)(s,{messages:d})}else{const t=s.substring(0,20)+"...",n=await(0,o.gS)((0,o.rJ)(i.db,"users",e.uid,"chats"),{title:t,createdAt:(0,o.O5)(),messages:d});b(n.id)}}}catch(d){console.error("Error calling Gemini API:",d);let s="\u54ce\u5440\uff01\u5f6cTalk \u76ee\u524d\u6709\u9ede\u5fd9\u788c\uff0c\u5c31\u50cf\u5ec9\u4e16\u5f6c\u5728\u5834\u4e0a\u4e00\u6a23\u5206\u8eab\u4e4f\u8853\uff01\u9019\u662f\u500b\u66ab\u6642\u7684\u72c0\u6cc1\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u4e00\u6b21\u3002";d.message&&d.message.includes("[503]")&&(s="\u54ce\u5440\uff01\u5f6cTalk \u76ee\u524d\u6709\u9ede\u5fd9\u788c\uff0c\u5c31\u50cf\u5ec9\u4e16\u5f6c\u5728\u5834\u4e0a\u4e00\u6a23\u5206\u8eab\u4e4f\u8853\uff01\u9019\u662f\u500b\u66ab\u6642\u7684\u72c0\u6cc1\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u4e00\u6b21\u3002");const t={sender:"bot",text:s},n=[...a,t];if(f(n),e&&!e.isAnonymous&&g){const s=(0,o.H9)(i.db,"users",e.uid,"chats",g);await(0,o.mZ)(s,{messages:n})}}finally{v(!1)}};return s?(0,r.jsx)(h.A,{loading:!0}):e&&!e.isAnonymous?(0,r.jsxs)("div",{className:"chat-page-container",children:[(0,r.jsx)("div",{className:"page-overlay "+(C?"active":""),onClick:()=>S(!1)}),(0,r.jsx)(d,{chats:t,activeChatId:g,onSelectChat:$,onNewChat:A,onDeleteChat:E,isOpen:C}),(0,r.jsx)(u,{messages:x,onSendMessage:T,isLoading:j,activeChatId:g,onToggleSidebar:()=>S(!C)})]}):(0,r.jsx)("div",{className:"chat-page-container guest-mode",children:(0,r.jsx)(u,{messages:x,onSendMessage:T,isLoading:j,activeChatId:null,onToggleSidebar:()=>{}})})}}}]);
//# sourceMappingURL=235.d6937c4d.chunk.js.map