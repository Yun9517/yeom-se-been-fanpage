{"version":3,"file":"static/js/235.a558c4b4.chunk.js","mappings":"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","sources":["hooks/useFirestoreDocument.js","components/ChatHistorySidebar.js","components/ChatWindow.js","components/ChatPage.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { doc, getDoc } from 'firebase/firestore';\nimport { db } from '../firebase';\n\nconst useFirestoreDocument = (collectionName, documentId) => {\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      setLoading(true);\n      setError(null);\n      try {\n        const docRef = doc(db, collectionName, documentId);\n        const docSnap = await getDoc(docRef);\n\n        if (docSnap.exists()) {\n          setData(docSnap.data());\n          console.log(`useFirestoreDocument: Fetched data for ${collectionName}/${documentId}.`);\n        } else {\n          setData(null);\n          console.log(`useFirestoreDocument: No document found for ${collectionName}/${documentId}.`);\n        }\n      } catch (err) {\n        console.error(`useFirestoreDocument: Error fetching document ${collectionName}/${documentId}:`, err);\n        setError(`無法載入 ${collectionName} 內容，請稍後再試。`);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, [collectionName, documentId]);\n\n  return { data, loading, error };\n};\n\nexport default useFirestoreDocument;\n","import React from 'react';\nimport { FaTrash, FaBars } from 'react-icons/fa';\n\nconst ChatHistorySidebar = ({ chats, activeChatId, onSelectChat, onNewChat, onDeleteChat, isOpen }) => {\n  return (\n    <div className={`chat-history-sidebar ${isOpen ? 'open' : ''}`}>\n      <button onClick={onNewChat} className=\"new-chat-btn\">\n        + 新增對話\n      </button>\n      <ul className=\"chat-history-list\">\n        {chats.map((chat) => (\n          <li\n            key={chat.id}\n            className={`chat-history-item ${chat.id === activeChatId ? 'active' : ''}`}\n            onClick={() => onSelectChat(chat.id)}\n          >\n            <span className=\"chat-item-title\" title={chat.title}>{chat.title}</span>\n            <button \n              className=\"delete-chat-btn\"\n              onClick={(e) => {\n                e.stopPropagation(); // Prevent li's onClick from firing\n                onDeleteChat(chat.id);\n              }}\n              title=\"刪除對話\"\n            >\n              <FaTrash />\n            </button>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n};\n\nexport default ChatHistorySidebar;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { FaBars } from 'react-icons/fa';\nimport './ChatPage.css';\n\nconst ChatWindow = ({ messages, onSendMessage, isLoading, activeChatId, onToggleSidebar }) => {\n  const [input, setInput] = useState('');\n  const messagesEndRef = useRef(null);\n\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n    }\n  }, [messages]);\n\n  // Clear input when starting a new chat\n  useEffect(() => {\n    if (!activeChatId) {\n      setInput('');\n    }\n  }, [activeChatId]);\n\n  const handleSend = () => {\n    if (input.trim() === '') return;\n    onSendMessage(input);\n    setInput('');\n  };\n\n  const handleInputChange = (e) => {\n    setInput(e.target.value);\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter' && !isLoading) {\n      handleSend();\n    }\n  };\n\n  return (\n    <div className=\"chat-window-main\">\n       <div className=\"beentalk-header\">\n        <button className=\"sidebar-toggle-btn\" onClick={onToggleSidebar}>\n          <FaBars />\n        </button>\n        <h2>彬Talk</h2>\n        <p>有想知道的都等你來問！</p>\n      </div>\n      <div className=\"beentalk-messages\" ref={messagesEndRef}>\n        {messages.map((msg, index) => (\n          <div key={index} className={`message ${msg.sender}`}>\n            {msg.text}\n          </div>\n        ))}\n        {isLoading && <div className=\"message bot\">請稍等...</div>}\n      </div>\n      <div className=\"beentalk-input-area\">\n        <input\n          type=\"text\"\n          value={input}\n          onChange={handleInputChange}\n          onKeyPress={handleKeyPress}\n          placeholder={\"輸入你想問的問題...\"}\n          disabled={isLoading}\n        />\n        <button onClick={handleSend} disabled={isLoading} className=\"btn btn-theme-gradient\">\n          傳送\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default ChatWindow;\n","import React, { useState, useEffect } from 'react';\nimport { useUser } from '../context/UserContext';\nimport { db } from '../firebase';\nimport { collection, query, orderBy, onSnapshot, addDoc, doc, updateDoc, deleteDoc, serverTimestamp } from 'firebase/firestore';\nimport { GoogleGenerativeAI } from '@google/generative-ai';\n\nimport ChatHistorySidebar from './ChatHistorySidebar';\nimport ChatWindow from './ChatWindow';\nimport LoadingSpinner from './LoadingSpinner';\nimport useFirestoreDocument from '../hooks/useFirestoreDocument';\n\nimport './ChatPage.css';\n\nconst ChatPage = () => {\n  const { user, authLoading } = useUser();\n  const [chats, setChats] = useState([]);\n  const [activeChatId, setActiveChatId] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [genAI, setGenAI] = useState(null);\n  const [isSidebarOpen, setSidebarOpen] = useState(false);\n  const { data: aboutContent, loading: aboutLoading } = useFirestoreDocument('pages', 'about');\n\n  // Initialize Gemini AI\n  useEffect(() => {\n    const apiKey = process.env.REACT_APP_GEMINI_API_KEY;\n    if (apiKey) {\n      const ai = new GoogleGenerativeAI(apiKey);\n      setGenAI(ai);\n    }\n  }, []);\n\n  // Effect for logged-in user data\n  useEffect(() => {\n    if (!user || user.isAnonymous) {\n      setChats([]);\n      setActiveChatId(null);\n      setMessages([]); // Clear all data on logout or for anonymous user\n      return;\n    }\n\n    // Fetch user's chat list\n    const q = query(collection(db, 'users', user.uid, 'chats'), orderBy('createdAt', 'desc'));\n    const unsubscribeChats = onSnapshot(q, (snapshot) => {\n      const chatList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n      setChats(chatList);\n    });\n\n    // Fetch messages for the active chat\n    let unsubscribeMessages = () => {};\n    if (activeChatId) {\n      unsubscribeMessages = onSnapshot(doc(db, 'users', user.uid, 'chats', activeChatId), (doc) => {\n        if (doc.exists()) {\n          setMessages(doc.data().messages || []);\n        }\n      });\n    } else {\n        setMessages([]); // Clear messages if no chat is active\n    }\n\n    return () => {\n        unsubscribeChats();\n        unsubscribeMessages();\n    };\n  }, [user, activeChatId]);\n\n\n  const handleSelectChat = (chatId) => {\n    setActiveChatId(chatId);\n    setSidebarOpen(false); // Close sidebar on selection\n  };\n\n  const handleNewChat = () => {\n    setActiveChatId(null);\n    setMessages([]);\n    setSidebarOpen(false); // Close sidebar on new chat\n  };\n\n  const handleDeleteChat = async (chatId) => {\n    if (!user || user.isAnonymous || !chatId) return;\n    if (window.confirm('您確定要刪除這段對話嗎？')) {\n      await deleteDoc(doc(db, 'users', user.uid, 'chats', chatId));\n      if (activeChatId === chatId) {\n        handleNewChat();\n      }\n    }\n  };\n\n  const handleSendMessage = async (inputText) => {\n    const isGuest = !user || user.isAnonymous;\n\n    if (!genAI || (!isGuest && aboutLoading)) return;\n\n    const userMessage = { sender: 'user', text: inputText };\n    setIsLoading(true);\n    \n    const newMessages = [...messages, userMessage];\n    setMessages(newMessages);\n\n    const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\n    let context = '';\n    if (aboutContent) {\n      context = `\n以下是網站關於廉世彬的介紹內容，請參考這些資訊來回答問題：\n${aboutContent.section2022Title}: ${aboutContent.section2022Content}\n${aboutContent.section2023Title}: ${aboutContent.section2023Content}\n${aboutContent.section2025Title}: ${aboutContent.section2025Content}\n`;\n    }\n\n    const loginPromptSegment = isGuest \n      ? `在回答完問題後，請用友善且簡短的語氣，溫馨地提醒使用者「對了!!登入後就可以保存我們的對話紀錄喔！」，但如果使用者只是簡單問候(例如:你好)，則不需提醒。`\n      : '';\n\n    const prompt = `你是一位熱情且樂於助人的助理，也是啦啦隊員廉世彬（廉世彬）的超級粉絲。你的目標是精簡的回答有關她的問題。如果問題與她無關，請禮貌地拒絕並將話題引導回廉世彬。 ${loginPromptSegment}\n\n${context}\n\n以下是固定的基本資料：\n出生: 2002年4月23日, 韓國首爾\n身高: 166cm\n學歷: 白石藝術大學 實用音樂系\n出道日期: 2022年\nMBTI: ISTP\nInstagram: beena._s2\nInstagram粉絲數: 破十萬人，還在增加唷!!\nThreads: beena._s2，阿彬會常常跟粉絲們互動唷!!\nTwitter: 沒在用，請去IG或Thread找阿彬\nFB: 沒在用，請去IG或Thread找阿彬\nYouTube: https://www.youtube.com/@MyAsteroids2\n夢想: 成為一名優秀的音樂人和啦啦隊員，你知道嗎，如果阿彬沒當啦啦隊，會想去當歌手呢!!\n興趣: 音樂、舞蹈、運動、與粉絲互動\n特長: 舞蹈、音樂創作、啦啦隊表演\n喜歡的食物: 韓國料理、甜點、台灣的雞排等，阿彬不挑食\n\n啦啦隊經歷：\n2022年: KEPCO Vixtorm Volleyball Team, Hana Bank Women's Basketball Team\n2023年: 起亞虎, 高陽索諾天空槍手\n2024年: 起亞虎, 安養正官庄赤紅火箭\n2025年: 樂天桃猿, NC恐龍\n\n音樂作品：\n2024年: Snooze - 새벽감성\n2025年: Snooze - Cherry Blooming\n\n明星賽特殊經歷:\n與禹洙漢、河智媛，在明星賽期間在外野開快閃餐廳: 好厝邊〝Hasubeen〞，兩天都賣光光唷!!\n好厝邊〝Hasubeen〞: 是跟\"響食天堂\"集團合作的品牌唷!!的店名取自三人名字的諧音，象徵著她們的合作精神，也希望成為大家的「好朋友、好鄰居」。 他們也參與了快閃店的企劃、品牌、形象設計，並由河智媛手繪店內主視覺!\n\n近況:\n跟翻譯\"粒姐\"常常形影不離的被粉絲拍到，被粉絲說跟翻譯是雙胞胎\n\n問題：${inputText}`;\n\n    try {\n      const result = await model.generateContent(prompt);\n      const response = await result.response;\n      const botText = response.text();\n      const botMessage = { sender: 'bot', text: botText };\n      const finalMessages = [...newMessages, botMessage];\n      setMessages(finalMessages);\n\n      if (user && !user.isAnonymous) {\n        let currentChatId = activeChatId;\n        if (!currentChatId) {\n          const firstTitle = inputText.substring(0, 20) + '...';\n          const newChatRef = await addDoc(collection(db, 'users', user.uid, 'chats'), {\n            title: firstTitle,\n            createdAt: serverTimestamp(),\n            messages: finalMessages,\n          });\n          setActiveChatId(newChatRef.id);\n        } else {\n          const chatRef = doc(db, 'users', user.uid, 'chats', currentChatId);\n          await updateDoc(chatRef, { messages: finalMessages });\n        }\n      }\n\n    } catch (error) {\n      console.error(\"Error calling Gemini API:\", error);\n      let botMessageText = '哎呀！彬Talk 目前有點忙碌，就像廉世彬在場上一樣分身乏術！這是個暫時的狀況，請稍後再試一次。';\n      if (error.message && error.message.includes('[503]')) {\n          botMessageText = '哎呀！彬Talk 目前有點忙碌，就像廉世彬在場上一樣分身乏術！這是個暫時的狀況，請稍後再試一次。';\n      }\n      const errorMessage = { sender: 'bot', text: botMessageText };\n      const finalMessages = [...newMessages, errorMessage];\n      setMessages(finalMessages);\n\n      // Also save the error message to history for logged-in users\n      if (user && !user.isAnonymous && activeChatId) {\n          const chatRef = doc(db, 'users', user.uid, 'chats', activeChatId);\n          await updateDoc(chatRef, { messages: finalMessages });\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (authLoading) {\n    return <LoadingSpinner loading={true} />;\n  }\n\n  if (user && !user.isAnonymous) {\n    // Logged-in user UI\n    return (\n      <div className=\"chat-page-container\">\n        <div className={`page-overlay ${isSidebarOpen ? 'active' : ''}`} onClick={() => setSidebarOpen(false)}></div>\n        <ChatHistorySidebar \n          chats={chats}\n          activeChatId={activeChatId}\n          onSelectChat={handleSelectChat}\n          onNewChat={handleNewChat}\n          onDeleteChat={handleDeleteChat}\n          isOpen={isSidebarOpen}\n        />\n        <ChatWindow \n          messages={messages}\n          onSendMessage={handleSendMessage}\n          isLoading={isLoading}\n          activeChatId={activeChatId}\n          onToggleSidebar={() => setSidebarOpen(!isSidebarOpen)}\n        />\n      </div>\n    );\n  } else {\n    // Guest & Anonymous User UI\n    return (\n        <div className=\"chat-page-container guest-mode\">\n            <ChatWindow \n                messages={messages}\n                onSendMessage={handleSendMessage}\n                isLoading={isLoading}\n                activeChatId={null}\n                onToggleSidebar={() => {}}\n            />\n        </div>\n    );\n  }\n};\n\nexport default ChatPage;"],"names":["useFirestoreDocument","collectionName","documentId","data","setData","useState","loading","setLoading","error","setError","useEffect","async","docRef","doc","db","docSnap","getDoc","exists","console","log","err","fetchData","_ref","chats","activeChatId","onSelectChat","onNewChat","onDeleteChat","isOpen","_jsxs","className","children","_jsx","onClick","map","chat","id","title","e","stopPropagation","FaTrash","messages","onSendMessage","isLoading","onToggleSidebar","input","setInput","messagesEndRef","useRef","current","scrollIntoView","behavior","handleSend","trim","FaBars","ref","msg","index","sender","text","type","value","onChange","target","onKeyPress","key","placeholder","disabled","ChatPage","user","authLoading","useUser","setChats","setActiveChatId","setMessages","setIsLoading","genAI","setGenAI","isSidebarOpen","setSidebarOpen","aboutContent","aboutLoading","apiKey","process","ai","GoogleGenerativeAI","isAnonymous","q","query","collection","uid","orderBy","unsubscribeChats","onSnapshot","snapshot","chatList","docs","unsubscribeMessages","handleSelectChat","chatId","handleNewChat","handleDeleteChat","window","confirm","deleteDoc","handleSendMessage","isGuest","userMessage","inputText","newMessages","model","getGenerativeModel","context","section2022Title","section2022Content","section2023Title","section2023Content","section2025Title","section2025Content","prompt","result","generateContent","response","botMessage","finalMessages","currentChatId","chatRef","updateDoc","firstTitle","substring","newChatRef","addDoc","createdAt","serverTimestamp","botMessageText","message","includes","errorMessage","LoadingSpinner","ChatHistorySidebar","ChatWindow"],"sourceRoot":""}