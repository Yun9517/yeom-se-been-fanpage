"use strict";(self.webpackChunkyeom_se_been_fanpage=self.webpackChunkyeom_se_been_fanpage||[]).push([[325],{1131:(e,s,a)=>{a.d(s,{A:()=>l});var t=a(5043),r=a(6667),n=a(791);const l=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const[l,o]=(0,t.useState)([]),[i,c]=(0,t.useState)(!0),[d,m]=(0,t.useState)(null);return(0,t.useEffect)(()=>{c(!0),m(null);const t=(0,r.rJ)(n.db,e);let l=(0,r.P)(t,...s);let i=null;return a?i=(0,r.aQ)(l,s=>{const a=s.docs.map(e=>({id:e.id,...e.data()}));o(a),c(!1),m(null),console.log(`useFirestoreCollection: Live update from ${e}.`)},s=>{console.error(`useFirestoreCollection: Live update error for ${e}:`,s),m(`\u5373\u6642\u66f4\u65b0 ${e} \u8cc7\u6599\u5931\u6557\u3002`),c(!1)}):(async()=>{try{const s=(await(0,r.GG)(l)).docs.map(e=>({id:e.id,...e.data()}));o(s),console.log(`useFirestoreCollection: Fetched data from ${e}.`)}catch(s){console.error(`useFirestoreCollection: Error fetching data from ${e}:`,s),m(`\u7121\u6cd5\u8f09\u5165 ${e} \u8cc7\u6599\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u3002`)}finally{c(!1)}})(),()=>{i&&i()}},[e,s,a]),{data:l,loading:i,error:d}}},7325:(e,s,a)=>{a.r(s),a.d(s,{default:()=>v});var t=a(5043),r=a(3519),n=a(1719),l=a(7417),o=a(2223),i=a(3722),c=a(4282),d=a(4258),m=a(2678),u=a(1131),h=a(6667),g=a(791),f=a(579);const v=()=>{const{user:e}=(0,m.J)(),[s,a]=(0,t.useState)(""),[v,x]=(0,t.useState)(!1),j=(0,t.useRef)(null),p=(0,t.useRef)(null),A=(0,t.useMemo)(()=>[(0,h.My)("createdAt"),(0,h.AB)(100)],[]),{data:N,loading:b,error:y}=(0,u.A)("messages",A,!0);(0,t.useEffect)(()=>{(()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[N]),(0,t.useEffect)(()=>{p.current&&(p.current.scrollTop=0)},[]);return e?(0,f.jsxs)(r.A,{className:"mt-5 chat-container",children:[(0,f.jsx)("h2",{className:"mb-4",children:"\u7c89\u7d72\u804a\u5929\u5ba4"}),(0,f.jsxs)("div",{className:"messages-area",ref:p,children:[b&&(0,f.jsx)(l.A,{animation:"border"}),y&&(0,f.jsxs)(n.A,{variant:"danger",children:["\u7121\u6cd5\u8f09\u5165\u8a0a\u606f\uff1a",y.message]}),(0,f.jsxs)(o.A,{children:[N.map(s=>{var a;return(0,f.jsx)(o.A.Item,{className:"message-item "+(s.userId===e.uid?"sent":"received"),children:(0,f.jsxs)("div",{className:"message-content",children:[(0,f.jsx)("strong",{className:"message-user",children:s.userName}),(0,f.jsx)("div",{className:"message-text",children:s.text}),(0,f.jsx)("small",{className:"message-time",children:null===(a=s.createdAt)||void 0===a?void 0:a.toDate().toLocaleTimeString()})]})},s.id)}),(0,f.jsx)("div",{ref:j})]})]}),(0,f.jsx)("div",{className:"picker-container",children:v&&(0,f.jsx)(d.Ay,{onEmojiClick:e=>{a(s=>s+e.emoji),x(!1)}})}),(0,f.jsxs)(i.A,{onSubmit:async t=>{if(t.preventDefault(),""!==s.trim()&&e)try{await(0,h.gS)((0,h.rJ)(g.db,"messages"),{text:s,createdAt:(0,h.O5)(),userId:e.uid,userName:e.displayName||"\u533f\u540d\u7528\u6236"}),a("")}catch(r){console.error("Error sending message:",r)}},className:"message-form",children:[(0,f.jsx)(i.A.Control,{type:"text",value:s,onChange:e=>a(e.target.value),placeholder:"\u8f38\u5165\u8a0a\u606f...",autoComplete:"off"}),(0,f.jsx)(c.A,{variant:"light",onClick:()=>x(e=>!e),className:"emoji-button",children:"\ud83d\ude0a"}),(0,f.jsx)(c.A,{variant:"primary",type:"submit",className:"btn-theme-gradient",children:"\u50b3\u9001"})]})]}):(0,f.jsx)(r.A,{className:"mt-5",children:(0,f.jsx)(n.A,{variant:"warning",children:"\u8acb\u5148\u767b\u5165\u624d\u80fd\u4f7f\u7528\u804a\u5929\u5ba4\u3002"})})}}}]);
//# sourceMappingURL=325.798e8c44.chunk.js.map