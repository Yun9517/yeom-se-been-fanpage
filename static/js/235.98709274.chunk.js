"use strict";(self.webpackChunkyeom_se_been_fanpage=self.webpackChunkyeom_se_been_fanpage||[]).push([[235],{1290:(e,s,t)=>{t.d(s,{A:()=>o});var n=t(5043),a=t(6667),i=t(791);const o=(e,s)=>{const[t,o]=(0,n.useState)(null),[c,l]=(0,n.useState)(!0),[d,r]=(0,n.useState)(null);return(0,n.useEffect)(()=>{(async()=>{l(!0),r(null);try{const t=(0,a.H9)(i.db,e,s),n=await(0,a.x7)(t);n.exists()?(o(n.data()),console.log(`useFirestoreDocument: Fetched data for ${e}/${s}.`)):(o(null),console.log(`useFirestoreDocument: No document found for ${e}/${s}.`))}catch(t){console.error(`useFirestoreDocument: Error fetching document ${e}/${s}:`,t),r(`\u7121\u6cd5\u8f09\u5165 ${e} \u5167\u5bb9\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u3002`)}finally{l(!1)}})()},[e,s]),{data:t,loading:c,error:d}}},2616:(e,s,t)=>{t.r(s),t.d(s,{default:()=>g});var n=t(5043),a=t(2678),i=t(791),o=t(6667),c=t(1048),l=t(184),d=t(579);const r=e=>{let{chats:s,activeChatId:t,onSelectChat:n,onNewChat:a,onDeleteChat:i,isOpen:o}=e;return(0,d.jsxs)("div",{className:"chat-history-sidebar "+(o?"open":""),children:[(0,d.jsx)("button",{onClick:a,className:"new-chat-btn",children:"+ \u65b0\u589e\u5c0d\u8a71"}),(0,d.jsx)("ul",{className:"chat-history-list",children:s.map(e=>(0,d.jsxs)("li",{className:"chat-history-item "+(e.id===t?"active":""),onClick:()=>n(e.id),children:[(0,d.jsx)("span",{className:"chat-item-title",title:e.title,children:e.title}),(0,d.jsx)("button",{className:"delete-chat-btn",onClick:s=>{s.stopPropagation(),i(e.id)},title:"\u522a\u9664\u5c0d\u8a71",children:(0,d.jsx)(l.qbC,{})})]},e.id))})]})},u=e=>{let{messages:s,onSendMessage:t,isLoading:a,activeChatId:i,onToggleSidebar:o,isGuest:c}=e;const[r,u]=(0,n.useState)(""),h=(0,n.useRef)(null);(0,n.useEffect)(()=>{(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[s]),(0,n.useEffect)(()=>{i||u("")},[i]);const m=()=>{""!==r.trim()&&(t(r),u(""))};return(0,d.jsxs)("div",{className:"chat-window-main",children:[(0,d.jsxs)("div",{className:"beentalk-header",children:[!c&&(0,d.jsx)("button",{className:"sidebar-toggle-btn",onClick:o,children:(0,d.jsx)(l.OXb,{})}),(0,d.jsx)("h2",{children:"\u5f6cTalk"}),(0,d.jsx)("p",{children:"\u6709\u60f3\u77e5\u9053\u7684\u90fd\u7b49\u4f60\u4f86\u554f\uff01"})]}),(0,d.jsxs)("div",{className:"beentalk-messages",children:[s.map((e,s)=>(0,d.jsx)("div",{className:`message ${e.sender}`,children:e.text},s)),a&&(0,d.jsx)("div",{className:"message bot",children:"\u8acb\u7a0d\u7b49..."}),(0,d.jsx)("div",{ref:h})," "]}),(0,d.jsxs)("div",{className:"beentalk-input-area",children:[(0,d.jsx)("input",{type:"text",value:r,onChange:e=>{u(e.target.value)},onKeyPress:e=>{"Enter"!==e.key||a||m()},placeholder:"\u8f38\u5165\u4f60\u60f3\u554f\u7684\u554f\u984c...",disabled:a}),(0,d.jsx)("button",{onClick:m,disabled:a,className:"btn btn-theme-gradient",children:"\u50b3\u9001"})]})]})};var h=t(6045),m=t(1290);const g=()=>{const{user:e,authLoading:s}=(0,a.J)(),[t,l]=(0,n.useState)([]),[g,b]=(0,n.useState)(null),[v,x]=(0,n.useState)([]),[f,j]=(0,n.useState)(!1),[p,y]=(0,n.useState)(null),[C,S]=(0,n.useState)(!1),{data:$,loading:N}=(0,m.A)("pages","about"),{data:k,loading:w}=(0,m.A)("pages","beentalk");(0,n.useEffect)(()=>{const e="AIzaSyApnG7hMqjd5XRgoEkWSiSWny75or1WzhQ";if(e){const s=new c.ij(e);y(s)}},[]),(0,n.useEffect)(()=>{if(!e||e.isAnonymous)return l([]),b(null),void x([]);const s=(0,o.P)((0,o.rJ)(i.db,"users",e.uid,"chats"),(0,o.My)("createdAt","desc")),t=(0,o.aQ)(s,e=>{const s=e.docs.map(e=>({id:e.id,...e.data()}));l(s)});let n=()=>{};return g?n=(0,o.aQ)((0,o.H9)(i.db,"users",e.uid,"chats",g),e=>{e.exists()&&x(e.data().messages||[])}):x([]),()=>{t(),n()}},[e,g]);const A=e=>{b(e),S(!1)},E=()=>{b(null),x([]),S(!1)},I=async s=>{e&&!e.isAnonymous&&s&&window.confirm("\u60a8\u78ba\u5b9a\u8981\u522a\u9664\u9019\u6bb5\u5c0d\u8a71\u55ce\uff1f")&&(await(0,o.kd)((0,o.H9)(i.db,"users",e.uid,"chats",s)),g===s&&E())},T=async s=>{const t=!e||e.isAnonymous;if(!p||!t&&(N||w))return;const n={sender:"user",text:s};j(!0);const a=[...v,n];x(a);const c=p.getGenerativeModel({model:"gemini-1.5-flash"});let l="";$&&(l=`\n\u4ee5\u4e0b\u662f\u7db2\u7ad9\u95dc\u65bc\u5ec9\u4e16\u5f6c\u7684\u4ecb\u7d39\u5167\u5bb9\uff0c\u8acb\u53c3\u8003\u9019\u4e9b\u8cc7\u8a0a\u4f86\u56de\u7b54\u554f\u984c\uff1a\n${$.section2022Title}: ${$.section2022Content}\n${$.section2023Title}: ${$.section2023Content}\n${$.section2025Title}: ${$.section2025Content}\n`);const d=(null===k||void 0===k?void 0:k.persona)||"\u4f60\u662f\u4e00\u4f4d\u71b1\u60c5\u4e14\u6a02\u65bc\u52a9\u4eba\u7684\u52a9\u7406\u3002",r=(null===k||void 0===k?void 0:k.static_data)||"",u=null!==k&&void 0!==k&&k.faq?`\n\u5e38\u898b\u554f\u984c\u53c3\u8003\uff1a\n${k.faq}`:"",h=`${d} ${t&&(null===k||void 0===k?void 0:k.guest_prompt)||""}\n\n${r}\n${u}\n${l}\n\n\u554f\u984c\uff1a${s}`;try{const t=await c.generateContent(h),n=await t.response,l={sender:"bot",text:n.text()},d=[...a,l];if(x(d),e&&!e.isAnonymous){let t=g;if(t){const s=(0,o.H9)(i.db,"users",e.uid,"chats",t);await(0,o.mZ)(s,{messages:d})}else{const t=s.substring(0,20)+"...",n=await(0,o.gS)((0,o.rJ)(i.db,"users",e.uid,"chats"),{title:t,createdAt:(0,o.O5)(),messages:d});b(n.id)}}}catch(m){console.error("Error calling Gemini API:",m);const s={sender:"bot",text:"\u54ce\u5440\uff01\u5f6cTalk\u76ee\u524d\u6709\u9ede\u5fd9\u788c\uff0c\u5c31\u50cf\u5ec9\u4e16\u5f6c\u5728\u5834\u4e0a\u4e00\u6a23\u5206\u8eab\u4e4f\u8853\uff01\u9019\u53ef\u80fd\u662f\u56e0\u70ba\u77ed\u6642\u9593\u5167\u7684\u7528\u91cf\u9054\u5230\u4e86\u4e0a\u9650\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u4e00\u6b21\uff0c\u6216\u660e\u5929\u518d\u56de\u4f86\u770b\u770b\u5594\uff0c\u4e0d\u597d\u610f\u601d\uff01"},t=[...a,s];if(x(t),e&&!e.isAnonymous&&g){const s=(0,o.H9)(i.db,"users",e.uid,"chats",g);await(0,o.mZ)(s,{messages:t})}}finally{j(!1)}};if(s)return(0,d.jsx)(h.A,{loading:!0});const _=N||w;return e&&!e.isAnonymous?(0,d.jsxs)("div",{className:"chat-page-container",children:[(0,d.jsx)("div",{className:"page-overlay "+(C?"active":""),onClick:()=>S(!1)}),(0,d.jsx)(r,{chats:t,activeChatId:g,onSelectChat:A,onNewChat:E,onDeleteChat:I,isOpen:C}),(0,d.jsx)(u,{messages:v,onSendMessage:T,isLoading:f||_,activeChatId:g,onToggleSidebar:()=>S(!C),isGuest:!1})]}):(0,d.jsx)("div",{className:"chat-page-container guest-mode",children:(0,d.jsx)(u,{messages:v,onSendMessage:T,isLoading:f||_,activeChatId:null,onToggleSidebar:()=>{},isGuest:!0})})}}}]);
//# sourceMappingURL=235.98709274.chunk.js.map