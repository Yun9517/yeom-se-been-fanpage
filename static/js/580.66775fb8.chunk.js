"use strict";(self.webpackChunkyeom_se_been_fanpage=self.webpackChunkyeom_se_been_fanpage||[]).push([[580],{6580:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var n=t(5043),r=t(9367),a=t(5200),c=t(184),o=t(7417),i=t(1719),l=t(457),d=t(791),h=t(6667),u=t(8279),x=t(3814),j=t(4196),m=t(4282),p=t(579);const g=()=>{const[e,s]=(0,n.useState)([]),[t,r]=(0,n.useState)([]),[a]=(0,u.hD)(d.j),[o,i]=(0,n.useState)(!0),[l,g]=(0,n.useState)(10),[v,b]=(0,n.useState)(1);(0,n.useEffect)(()=>{i(!0);const e=(0,h.rJ)(d.db,"scores"),t=(0,h.P)(e,(0,h.My)("score","desc")),n=(0,h.aQ)(t,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));s(t),i(!1)},e=>{console.error("Error fetching scores:",e),i(!1)});return()=>n()},[]),(0,n.useEffect)(()=>{const s=(v-1)*l,t=s+l;r(e.slice(s,t))},[e,v,l]);const y=Math.ceil(e.length/l),f=e=>{const s=(v-1)*l+e;return 0===s?"rank-gold":1===s?"rank-silver":2===s?"rank-bronze":""};return(0,p.jsxs)("div",{className:"leaderboard-container mt-5",children:[(0,p.jsxs)(x.A.Group,{controlId:"pageSizeSelect",className:"mb-3",children:[(0,p.jsx)(x.A.Label,{children:"\u6bcf\u9801\u986f\u793a\u7b46\u6578:"}),(0,p.jsxs)(x.A.Control,{as:"select",value:l,onChange:e=>{g(Number(e.target.value)),b(1)},children:[(0,p.jsx)("option",{value:10,children:"10"}),(0,p.jsx)("option",{value:20,children:"20"}),(0,p.jsx)("option",{value:50,children:"50"}),(0,p.jsx)("option",{value:100,children:"100"})]})]}),(0,p.jsxs)(j.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,variant:"dark",children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{children:"#"}),(0,p.jsx)("th",{children:"\u73a9\u5bb6"}),(0,p.jsx)("th",{children:"\u5206\u6578"}),(0,p.jsx)("th",{children:"\u65e5\u671f"})]})}),(0,p.jsx)("tbody",{children:o?(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:"4",className:"text-center",children:"\u8f09\u5165\u4e2d..."})}):t.map((e,s)=>{var t;return(0,p.jsxs)("tr",{className:`${f((v-1)*l+s)} ${a&&e.userId===a.uid?"current-user-row":""}`,children:[(0,p.jsx)("td",{className:"rank-cell",children:(v-1)*l+s+1<=3?(0,p.jsx)(c.SBv,{className:"trophy-icon"}):(v-1)*l+s+1}),(0,p.jsx)("td",{children:e.userName}),(0,p.jsx)("td",{children:e.score}),(0,p.jsx)("td",{children:new Date(null===(t=e.createdAt)||void 0===t?void 0:t.toDate()).toLocaleDateString()})]},e.id)})})]}),(0,p.jsxs)("div",{className:"d-flex justify-content-between mt-3",children:[v>1&&(0,p.jsx)(m.A,{onClick:()=>{v>1&&b(e=>e-1)},disabled:o,variant:"secondary",children:"\u4e0a\u4e00\u9801"}),v<y&&(0,p.jsx)(m.A,{onClick:()=>{v<y&&b(e=>e+1)},disabled:o,variant:"secondary",children:"\u4e0b\u4e00\u9801"})]})]})},v=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return[...e].sort(()=>.5-Math.random()).slice(0,s)};const b=function(){var e,s;const[t,x]=(0,n.useState)([]),[j,m]=(0,n.useState)([]),[b,y]=(0,n.useState)(0),[f,w]=(0,n.useState)(0),[N,A]=(0,n.useState)(!1),[S,k]=(0,n.useState)(!0),[C,q]=(0,n.useState)(null),[$,z]=(0,n.useState)([]),[_]=(0,u.hD)(d.j);(0,n.useEffect)(()=>{(async()=>{try{const e=(await(0,h.GG)((0,h.rJ)(d.db,"quizzes"))).docs.map(e=>e.data());x(e),m(v(e)),k(!1)}catch(e){console.error("Error fetching questions from Firestore:",e),q("\u7121\u6cd5\u8f09\u5165\u984c\u76ee\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u3002"),k(!1)}})()},[]),(0,n.useEffect)(()=>{(async()=>{if(N&&_&&!_.isAnonymous)try{await(0,h.gS)((0,h.rJ)(d.db,"scores"),{userName:_.displayName,userId:_.uid,score:f,userAnswers:$,createdAt:(0,h.O5)()})}catch(e){console.error("Error adding document: ",e)}})()},[N,_,f,$]);const E=(0,n.useCallback)(()=>{y(0),w(0),A(!1),m(v(t)),z([])},[t]),D=()=>({shareText:`\u6211\u5728 \uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\u4e2d\u7372\u5f97\u4e86 ${f} \u5206\uff01\u5feb\u4f86\u6311\u6230\u770b\u770b\u4f60\u7684\u5206\u6578\uff01`,shareUrl:window.location.href}),I="yeomsebeen_field.jpg";return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(r.mg,{children:[(0,p.jsx)("title",{children:"\uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\uff01"}),(0,p.jsx)("meta",{property:"og:title",content:"\uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\uff01"}),(0,p.jsx)("meta",{property:"og:description",content:"\u5feb\u4f86\u6311\u6230\u770b\u770b\u4f60\u5c0d\u5ec9\u4e16\u5f6c\u7684\u4e86\u89e3\u7a0b\u5ea6\uff01"}),(0,p.jsx)("meta",{property:"og:image",content:`https://storage.googleapis.com/yeom-se-been-fanpage-assets/${I}`}),(0,p.jsx)("meta",{property:"og:url",content:window.location.href}),(0,p.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,p.jsx)("meta",{name:"twitter:image",content:`https://storage.googleapis.com/yeom-se-been-fanpage-assets/${I}`})]}),(0,p.jsxs)("div",{className:"fan-quiz-container",children:[(0,p.jsx)("h2",{children:"\uc5fc\uc138\ube48 \u7c89\u7d72\u5c0f\u904a\u6232\uff01"}),S&&(0,p.jsxs)("div",{className:"text-center",children:[(0,p.jsx)(o.A,{animation:"border",variant:"light"}),(0,p.jsx)("p",{className:"text-white-50 mt-2",children:"\u8f09\u5165\u4e2d..."})]}),C&&(0,p.jsx)(i.A,{variant:"danger",children:C}),!S&&!C&&(N?(0,p.jsxs)("div",{className:"score-section",children:[(0,p.jsxs)("div",{className:"score-text",children:["\u4f60\u7372\u5f97\u4e86 ",f," \u5206\uff0c\u7e3d\u5206 ",j.length," \u5206\uff01"]}),_&&_.isAnonymous&&(0,p.jsx)(i.A,{variant:"info",className:"mt-3",style:{fontSize:"0.85em"},children:"\u60a8\u7684\u4f5c\u7b54\u7d50\u679c\u4e0d\u6703\u9032\u5165\u6392\u884c\u699c\u3002\u5982\u9700\u8a18\u9304\u5206\u6578\uff0c\u8acb\u4f7f\u7528 Google \u5e33\u6236\u767b\u5165\u3002"}),(0,p.jsxs)("div",{className:"score-buttons",children:[(0,p.jsx)("button",{onClick:()=>{const{shareText:e,shareUrl:s}=D(),t=`${e} ${s}`;navigator.clipboard.writeText(t).then(()=>{alert("\u5206\u4eab\u9023\u7d50\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f\uff01")}).catch(e=>{console.error("\u7121\u6cd5\u8907\u88fd\u5206\u4eab\u9023\u7d50:",e)})},className:"quiz-button share-link-button",children:(0,p.jsx)(a.ayE,{})}),(0,p.jsx)("button",{onClick:E,className:"quiz-button play-again-button",children:(0,p.jsx)(a.wO2,{})}),(0,p.jsx)("button",{onClick:()=>{const{shareText:e,shareUrl:s}=D(),t=`https://line.me/R/msg/text/?${encodeURIComponent(`${e} ${s}`)}`;window.open(t,"_blank")},className:"quiz-button share-line-button",children:(0,p.jsx)(c.y16,{})})]}),(0,p.jsxs)("div",{className:"quiz-answers-summary mt-4",children:[(0,p.jsx)("h3",{children:"\u4f5c\u7b54\u7d50\u679c"}),$.map((e,s)=>(0,p.jsxs)("div",{className:"answer-item mb-3 p-3 border rounded",children:[(0,p.jsxs)("p",{children:[(0,p.jsxs)("strong",{children:["\u554f\u984c ",s+1,":"]})," ",e.question]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"\u4f60\u7684\u7b54\u6848:"})," ",(0,p.jsx)("span",{style:{color:e.isCorrect?"#28a745":"#dc3545"},children:e.userAnswer})]}),!e.isCorrect&&(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"\u6b63\u78ba\u7b54\u6848:"})," ",(0,p.jsx)("span",{style:{color:"#28a745"},children:e.correctAnswer})]})]},s))]})]}):j.length>0&&(0,p.jsxs)("div",{className:"question-section",children:[(0,p.jsxs)("div",{className:"question-count",children:[(0,p.jsxs)("span",{children:["\u554f\u984c ",b+1]}),"/",j.length]}),(0,p.jsx)("div",{className:"question-text",children:null===(e=j[b])||void 0===e?void 0:e.question}),(0,p.jsx)("div",{className:"answer-section",children:null===(s=j[b])||void 0===s?void 0:s.options.map((e,s)=>(0,p.jsx)("button",{onClick:()=>(e=>{const s=j[b],t=e===s.answer;t&&w(f+1),z(n=>[...n,{question:s.question,correctAnswer:s.answer,userAnswer:e,isCorrect:t}]);const n=b+1;n<j.length?y(n):A(!0)})(e),children:e},`${b}-${s}`))})]}))]}),(0,p.jsx)("div",{className:"leaderboard-section mt-5",children:(0,p.jsx)(l.A,{defaultActiveKey:"0",children:(0,p.jsxs)(l.A.Item,{eventKey:"0",children:[(0,p.jsx)(l.A.Header,{children:"\u6392\u884c\u699c"}),(0,p.jsx)(l.A.Body,{children:(0,p.jsx)(g,{})})]})})})]})}}}]);
//# sourceMappingURL=580.66775fb8.chunk.js.map